<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account | ToolNest</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #222831;
            --secondary: #D65A31;
            --light-gray: #EEEEEE;
            --dark-gray: #393E46;
            --success: #28a745;
            --error: #dc3545;
            --warning: #ffc107;
            --white: #FFFFFF;
            --shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
            --transition: all 0.25s ease;
        }

        body {
            background-color: var(--light-gray);
            color: var(--primary);
            line-height: 1.6;
            padding-top: 0; /* Remove this if you have a fixed header */
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s ease;
            text-align: center;
        }

        .btn:hover {
            background-color: #bf4f2c;
        }

        .btn-outline {
            background-color: transparent;
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .btn-outline:hover {
            background-color: rgba(214, 90, 49, 0.1);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        /* Header Styles */
        .site-header {
            background-color: var(--primary);
            color: white;
            z-index: 1000;
            width: 100%;
            font-size: 14px;
        }

        /* Upper Header Section */
        .header-upper {
            background-color: var(--primary);
            color: var(--white);
            padding: 8px 0;
            position: relative;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--white);
            text-decoration: none;
        }

        .logo span {
            color: var(--secondary);
        }

        /* Search Bar */
        .search-bar {
            display: flex;
            flex: 1;
            max-width: 400px;
            margin: 0 20px;
        }

        .search-bar input {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 4px 0 0 4px;
            font-size: 13px;
        }

        .search-bar button {
            background-color: var(--secondary);
            color: var(--white);
            border: none;
            padding: 8px 12px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-bar button:hover {
            background-color: #bf4f2c;
        }

        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-action-item {
            position: relative;
        }

        .action-link {
            color: var(--white);
            font-size: 16px;
            text-decoration: none;
            display: flex;
            align-items: center;
            position: relative;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--secondary);
            color: var(--white);
            font-size: 10px;
            font-weight: bold;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Auth Buttons */
        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        /* User Account */
        .user-account {
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
            padding: 4px 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            transition: var(--transition);
        }

        .user-account:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
            margin-right: 8px;
            font-size: 14px;
        }

        .user-name {
            max-width: 100px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
            font-size: 14px;
            margin: 0;
        }

        /* Lower Header */
        .header-lower {
            background-color: var(--white);
            box-shadow: var(--shadow);
            position: relative;
            font-size: 13px;
        }

        .category-nav {
            position: relative;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            display: block;
            padding: 12px 15px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        .nav-link:hover {
            color: var(--secondary);
        }

        .dropdown-toggle::after {
            content: "â–¼";
            font-size: 8px;
            margin-left: 4px;
            transition: var(--transition);
        }

        .nav-item:hover .dropdown-toggle::after {
            transform: rotate(180deg);
        }

        /* Dropdown Menus */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: var(--white);
            width: 200px;
            box-shadow: var(--shadow);
            border-radius: 4px;
            padding: 8px 0;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: var(--transition);
            z-index: 10;
        }

        .nav-item:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: block;
            padding: 8px 12px;
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
            font-size: 13px;
        }

        .dropdown-item:hover {
            background-color: var(--light-gray);
            color: var(--secondary);
        }

        /* User Dropdown */
        .user-dropdown {
            position: absolute;
            top: 45px;
            right: 0;
            width: 250px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            overflow: hidden;
        }

        .user-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown-header {
            padding: 15px;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            border-bottom: 1px solid #e5e5e5;
        }

        .user-dropdown-header .user-avatar {
            width: 40px;
            height: 40px;
            font-size: 16px;
            margin-right: 12px;
        }

        .user-info {
            flex: 1;
        }

        .user-email {
            margin: 0;
            font-size: 12px;
            color: var(--dark-gray);
        }

        .user-dropdown-body {
            padding: 8px 0;
        }

        .user-dropdown-body .dropdown-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
        }

        .user-dropdown-body .dropdown-item i {
            margin-right: 10px;
            color: var(--dark-gray);
            width: 20px;
            text-align: center;
            font-size: 16px;
        }

        .user-dropdown-footer {
            padding: 12px 15px;
            border-top: 1px solid #e5e5e5;
        }

        .btn-logout {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 10px;
            background-color: #f8f9fa;
            color: #dc3545;
            border: 1px solid #dc3545;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 13px;
        }

        .btn-logout:hover {
            background-color: #dc3545;
            color: var(--white);
        }

        .btn-logout i {
            margin-right: 8px;
        }

        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 5px;
            color: var(--white);
            font-size: 20px;
        }

        /* Backdrop */
        .backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 90;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .backdrop.show {
            opacity: 1;
            visibility: visible;
        }

        /* Page Title */
        .page-title {
            background-color: var(--primary);
            color: white;
            padding: 40px 0;
            margin-bottom: 30px;
            text-align: center;
        }

        .page-title h1 {
            font-size: 2.5rem;
        }

        /* Account Layout */
        .account-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
            margin-bottom: 50px;
        }

        /* Account Sidebar */
        .account-sidebar {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            height: fit-content;
        }

        .account-avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            background-color: var(--light-gray);
            border-radius: 50%;
            margin: 0 auto 15px;
            font-size: 2rem;
            font-weight: 600;
            color: var(--dark-gray);
        }

        .account-name {
            text-align: center;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .account-email {
            text-align: center;
            color: var(--dark-gray);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .sidebar-nav-menu {
            list-style: none;
            border-top: 1px solid var(--light-gray);
            padding-top: 15px;
        }

        .sidebar-nav-item {
            margin-bottom: 5px;
        }

        .sidebar-nav-link {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            color: var(--primary);
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .sidebar-nav-link:hover,
        .sidebar-nav-link.active {
            background-color: var(--light-gray);
            color: var(--secondary);
        }

        .nav-icon {
            margin-right: 10px;
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        .logout-btn {
            padding: 10px 15px;
            background-color: transparent;
            border: none;
            color: var(--dark-gray);
            text-align: left;
            width: 100%;
            cursor: pointer;
            display: flex;
            align-items: center;
            border-radius: 4px;
            margin-top: 30px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background-color: var(--light-gray);
            color: var(--error);
        }

        /* Account Content */
        .account-content {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        /* Dashboard Section */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background-color: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
        }

        .card-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .card-link {
            color: var(--dark-gray);
            text-decoration: none;
        }

        .card-link:hover {
            color: var(--secondary);
        }

        .welcome-message {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        .recent-orders {
            margin-bottom: 30px;
        }

        .recent-vehicles {
            margin-bottom: 30px;
        }

        .item-list {
            list-style: none;
        }

        .list-item {
            border-bottom: 1px solid var(--light-gray);
            padding: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .item-details h4 {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .item-meta {
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .item-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }

        .status-processing {
            background-color: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }

        .status-completed {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        .status-cancelled {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--error);
        }

        .view-all {
            display: block;
            text-align: center;
            margin-top: 20px;
            color: var(--secondary);
            text-decoration: none;
        }

        .view-all:hover {
            text-decoration: underline;
        }

        /* Orders Section */
        .orders-list {
            margin-bottom: 30px;
        }

        .order-item {
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .order-id {
            font-weight: 600;
        }

        .order-date {
            color: var(--dark-gray);
        }

        .order-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .order-details {
            margin-bottom: 15px;
        }

        .order-total {
            font-weight: 600;
            margin-bottom: 15px;
        }

        .order-products {
            margin-bottom: 15px;
        }

        .product-item {
            display: flex;
            margin-bottom: 10px;
        }

        .product-image {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            overflow: hidden;
            margin-right: 15px;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-details {
            flex: 1;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .product-meta {
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .pagination-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            margin: 0 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            color: var(--primary);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .pagination-btn.active {
            background-color: var(--secondary);
            border-color: var(--secondary);
            color: white;
        }

        .pagination-btn.disabled {
            color: #ccc;
            cursor: not-allowed;
        }

        /* Vehicles Section */
        .vehicles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .vehicle-card {
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }

        .vehicle-card.default::after {
            content: 'Default';
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            background-color: var(--secondary);
            color: white;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .vehicle-title {
            font-weight: 600;
            margin-bottom: 15px;
        }

        .vehicle-details {
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            margin-bottom: 5px;
        }

        .detail-label {
            width: 100px;
            font-weight: 600;
        }

        .detail-value {
            flex: 1;
        }

        .vehicle-actions {
            display: flex;
            gap: 10px;
        }

        .add-vehicle-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            height: 100%;
            text-decoration: none;
            color: var(--dark-gray);
            transition: all 0.3s ease;
        }

        .add-vehicle-btn:hover {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .add-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        /* Profile Section */
        .profile-form {
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .form-control.error {
            border-color: var(--error);
        }

        .error-message {
            color: var(--error);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .error-message.visible {
            display: block;
        }

        .form-actions {
            margin-top: 20px;
        }

        /* Service Bookings Section */
        .service-bookings-list {
            margin-bottom: 30px;
        }

        .service-item {
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .service-id {
            font-weight: 600;
        }

        .service-date {
            color: var(--dark-gray);
        }

        .service-details {
            margin-bottom: 15px;
        }

        .service-vehicle {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .service-type {
            margin-bottom: 5px;
        }

        .service-time {
            margin-bottom: 5px;
        }

        .service-price {
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* Alerts */
        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .alert-error {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--error);
            border: 1px solid var(--error);
        }

        /* Loading Spinner */
        .spinner-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 50px;
            width: 100%;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--secondary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 0;
        }

        .empty-icon {
            font-size: 3rem;
            color: var(--light-gray);
            margin-bottom: 20px;
        }

        .empty-text {
            color: var(--dark-gray);
            margin-bottom: 20px;
        }

        /* Footer */
        footer {
            background-color: var(--primary);
            color: white;
            padding: 50px 0 20px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-gray);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Responsive Styles */
        @media (max-width: 991px) {
            .search-bar {
                max-width: 250px;
            }
        }

        @media (max-width: 768px) {
            .account-layout {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .vehicles-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .order-header,
            .service-header {
                flex-direction: column;
                gap: 10px;
            }

            .header-container {
                flex-wrap: wrap;
            }

            .search-bar {
                order: 3;
                margin: 10px 0 0;
                max-width: 100%;
                width: 100%;
            }

            .mobile-menu-btn {
                display: block;
            }

            .header-lower {
                display: none;
            }

            .auth-buttons .btn-outline {
                display: none;
            }
        }
    </style>
</head>
<body>

<!-- Header Container -->
<header class="site-header">
    <!-- Upper Header Section -->
    <div class="header-upper">
        <div class="container header-container">
            <!-- Logo -->
            <a href="../index.html" class="logo">Tool<span>Nest</span></a>

            <!-- Search Bar -->
            <form id="searchForm" class="search-bar">
                <input type="text" id="searchInput" placeholder="Search for tools, brands, or sizes...">
                <button type="submit"><i class="fas fa-search"></i></button>
            </form>

            <!-- Header Actions -->
            <div class="header-actions">
                <!-- Cart Icon -->
                <div class="header-action-item" id="cartContainer">
                    <a href="cart.html" class="action-link">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </a>
                </div>

                <!-- Account Section (changes based on authentication status) -->
                <div class="header-action-item" id="accountContainer">
                    <!-- This will be populated by JavaScript based on authentication status -->
                </div>

                <!-- Mobile menu button -->
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Lower Header Section - Category Navigation -->
    <div class="header-lower">
        <div class="container">
            <nav class="category-nav">
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="products.html" class="nav-link">All Tools</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle">Shop By Vehicle</a>
                        <div class="dropdown-menu">
                            <a href="Tool-finder.html" class="dropdown-item">Tool Finder</a>
                            <a href="products.html?category=passenger" class="dropdown-item">Passenger Tools</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle">Brands</a>
                        <div class="dropdown-menu">
                            <a href="products.html?brand=michelin" class="dropdown-item">Michelin</a>
                            <a href="products.html?brand=goodyear" class="dropdown-item">Goodyear</a>
                            <a href="products.html?brand=bridgestone" class="dropdown-item">Bridgestone</a>
                            <a href="products.html?brand=continental" class="dropdown-item">Continental</a>
                            <a href="products.html?brand=pirelli" class="dropdown-item">Pirelli</a>
                            <a href="products.html?brands" class="dropdown-item">All Brands</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle">Services</a>
                        <div class="dropdown-menu">
                            <a href="service-booking.html?service=installation" class="dropdown-item">Tool Installation</a>
                            <a href="service-booking.html?service=alignment" class="dropdown-item">Wheel Alignment</a>
                            <a href="service-booking.html?service=rotation" class="dropdown-item">Tool Rotation</a>
                            <a href="service-booking.html?service=repair" class="dropdown-item">Flat Repair</a>
                            <a href="service-booking.html" class="dropdown-item">All Services</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a href="promotions.html" class="nav-link">Promotions</a>
                    </li>
                    <li class="nav-item">
                        <a href="contact.html" class="nav-link">Contact Us</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>

<!-- User account dropdown (only shown when logged in) -->
<div class="user-dropdown" id="userDropdown">
    <div class="user-dropdown-header">
        <div class="user-avatar">
            <span id="userInitials">U</span>
        </div>
        <div class="user-info">
            <p class="user-name" id="userDisplayName">User Name</p>
            <p class="user-email" id="userEmail">user@example.com</p>
        </div>
    </div>
    <div class="user-dropdown-body">
        <a href="user-account.html" class="dropdown-item">
            <i class="fas fa-user"></i> My Account
        </a>
        <a href="orders.html" class="dropdown-item">
            <i class="fas fa-box"></i> My Orders
        </a>
        <a href="user-vehicles.html" class="dropdown-item">
            <i class="fas fa-car"></i> My Vehicles
        </a>
        <a href="wishlist.html" class="dropdown-item">
            <i class="fas fa-heart"></i> Wishlist
        </a>
        <a href="user-settings.html" class="dropdown-item">
            <i class="fas fa-cog"></i> Settings
        </a>
        <a href="service-bookings.html" class="dropdown-item">
            <i class="fas fa-tools"></i> Service Bookings
        </a>
    </div>
    <div class="user-dropdown-footer">
        <button id="logoutBtn" class="btn-logout">
            <i class="fas fa-sign-out-alt"></i> Log Out
        </button>
    </div>
</div>

<!-- Backdrop overlay for dropdowns -->
<div class="backdrop" id="backdrop"></div>

<!-- Page Title -->
<section class="page-title">
    <div class="container">
        <h1>My Account</h1>
    </div>
</section>

<!-- Main Content -->
<div class="container">
    <!-- Alerts -->
    <div class="alert alert-success" id="alertSuccess"></div>
    <div class="alert alert-error" id="alertError"></div>

    <!-- Account Layout -->
    <div class="account-layout">
        <!-- Account Sidebar -->
        <div class="account-sidebar">
            <div class="account-avatar" id="userAvatar">
                JD
            </div>
            <div class="account-name" id="userName">John Doe</div>
            <div class="account-email" id="userEmail">john.doe@example.com</div>

            <ul class="sidebar-nav-menu">
                <li class="sidebar-nav-item">
                    <a href="#dashboard" class="sidebar-nav-link active" data-section="dashboard">
                        <span class="nav-icon">ðŸ“Š</span>
                        Dashboard
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a href="order-history.html" class="sidebar-nav-link" data-section="orders">
                        <span class="nav-icon">ðŸ“¦</span>
                        Orders
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a href="user-vehicles.html" class="sidebar-nav-link" data-section="vehicles">
                        <span class="nav-icon">ðŸš—</span>
                        My Vehicles
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a href="service-booking.html" class="sidebar-nav-link" data-section="services">
                        <span class="nav-icon">ðŸ”§</span>
                        Service Bookings
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a href="#profile" class="sidebar-nav-link" data-section="profile">
                        <span class="nav-icon">ðŸ‘¤</span>
                        Profile Settings
                    </a>
                </li>
            </ul>

            <button class="logout-btn" id="sidebarLogoutBtn">
                <span class="nav-icon">ðŸšª</span>
                Logout
            </button>
        </div>

        <!-- Account Content -->
        <div class="account-content">
            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboardSection">
                <h2 class="section-title">Dashboard</h2>

                <p class="welcome-message">Welcome back, <span id="welcomeName">John</span>!</p>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-title">Total Orders</div>
                        <div class="card-value" id="totalOrdersValue">0</div>
                        <a href="order-history.html" class="card-link" data-section="orders">View All Orders</a>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-title">Upcoming Services</div>
                        <div class="card-value" id="upcomingServicesValue">0</div>
                        <a href="#services" class="card-link" data-section="services">View All Services</a>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-title">Saved Vehicles</div>
                        <div class="card-value" id="savedVehiclesValue">0</div>
                        <a href="user-vehicles.html" class="card-link" data-section="vehicles">View All Vehicles</a>
                    </div>
                </div>

                <div class="recent-orders">
                    <h3>Recent Orders</h3>
                    <ul class="item-list" id="recentOrdersList">
                        <!-- Loading spinner -->
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </ul>
                    <a href="#orders" class="view-all" data-section="orders">View All Orders</a>
                </div>

                <div class="recent-vehicles">
                    <h3>My Vehicles</h3>
                    <ul class="item-list" id="recentVehiclesList">
                        <!-- Loading spinner -->
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </ul>
                    <a href="#vehicles" class="view-all" data-section="vehicles">View All Vehicles</a>
                </div>
            </div>

            <!-- Orders Section -->
            <div class="content-section" id="ordersSection">
                <h2 class="section-title">My Orders</h2>

                <div class="orders-list" id="ordersList">
                    <!-- Loading spinner -->
                    <div class="spinner-container">
                        <div class="spinner"></div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="ordersPagination">
                    <!-- Pagination will be generated here -->
                </div>
            </div>

            <!-- Vehicles Section -->
            <div class="content-section" id="vehiclesSection">
                <h2 class="section-title">My Vehicles</h2>

                <div class="vehicles-grid" id="vehiclesGrid">
                    <!-- Loading spinner -->
                    <div class="spinner-container">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Service Bookings Section -->
            <div class="content-section" id="servicesSection">
                <h2 class="section-title">My Service Bookings</h2>

                <div class="service-bookings-list" id="serviceBookingsList">
                    <!-- Loading spinner -->
                    <div class="spinner-container">
                        <div class="spinner"></div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="servicesPagination">
                    <!-- Pagination will be generated here -->
                </div>
            </div>

            <!-- Profile Settings Section -->
            <div class="content-section" id="profileSection">
                <h2 class="section-title">Profile Settings</h2>

                <form class="profile-form" id="profileForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName" class="form-label">First Name</label>
                            <input type="text" id="firstName" class="form-control" required>
                            <div class="error-message" id="firstNameError"></div>
                        </div>
                        <div class="form-group">
                            <label for="lastName" class="form-label">Last Name</label>
                            <input type="text" id="lastName" class="form-control" required>
                            <div class="error-message" id="lastNameError"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" id="email" class="form-control" required>
                        <div class="error-message" id="emailError"></div>
                    </div>

                    <div class="form-group">
                        <label for="phone" class="form-label">Phone Number</label>
                        <input type="tel" id="phone" class="form-control">
                        <div class="error-message" id="phoneError"></div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn" id="updateProfileBtn">Update Profile</button>
                    </div>
                </form>

                <h3 class="section-title">Change Password</h3>

                <form class="profile-form" id="passwordForm">
                    <div class="form-group">
                        <label for="currentPassword" class="form-label">Current Password</label>
                        <input type="password" id="currentPassword" class="form-control" required>
                        <div class="error-message" id="currentPasswordError"></div>
                    </div>

                    <div class="form-group">
                        <label for="newPassword" class="form-label">New Password</label>
                        <input type="password" id="newPassword" class="form-control" required>
                        <div class="error-message" id="newPasswordError"></div>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">Confirm New Password</label>
                        <input type="password" id="confirmPassword" class="form-control" required>
                        <div class="error-message" id="confirmPasswordError"></div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn" id="changePasswordBtn">Change Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Vehicle Modal -->
<div class="modal-overlay" id="vehicleModalOverlay">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="vehicleModalTitle">Add New Vehicle</h3>
            <button class="modal-close" id="vehicleModalClose">&times;</button>
        </div>
        <div class="modal-body">
            <form id="vehicleForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="vehicleMake" class="form-label">Make</label>
                        <input type="text" id="vehicleMake" class="form-control" required>
                        <div class="error-message" id="vehicleMakeError"></div>
                    </div>
                    <div class="form-group">
                        <label for="vehicleModel" class="form-label">Model</label>
                        <input type="text" id="vehicleModel" class="form-control" required>
                        <div class="error-message" id="vehicleModelError"></div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="vehicleYear" class="form-label">Year</label>
                        <input type="number" id="vehicleYear" class="form-control" required min="1900" max="2025">
                        <div class="error-message" id="vehicleYearError"></div>
                    </div>
                    <div class="form-group">
                        <label for="vehicleTrim" class="form-label">Trim (Optional)</label>
                        <input type="text" id="vehicleTrim" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label for="vehicleToolSize" class="form-label">Tool Size</label>
                    <input type="text" id="vehicleToolSize" class="form-control" placeholder="e.g. 205/55R16">
                    <div class="error-message" id="vehicleToolSizeError"></div>
                </div>

                <div class="form-group">
                    <label for="vehicleLicensePlate" class="form-label">License Plate (Optional)</label>
                    <input type="text" id="vehicleLicensePlate" class="form-control">
                </div>

                <div class="form-group">
                    <label for="vehicleNickname" class="form-label">Nickname (Optional)</label>
                    <input type="text" id="vehicleNickname" class="form-control" placeholder="e.g. My Family Car">
                </div>

                <div class="form-group">
                    <label class="form-check">
                        <input type="checkbox" id="vehicleDefault">
                        Set as default vehicle
                    </label>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" id="vehicleModalCancel">Cancel</button>
            <button class="btn" id="vehicleModalSave">Save Vehicle</button>
        </div>
    </div>
</div>

<!-- Footer Section -->
<footer>
    <div class="container">
        <div class="footer-container">
            <div class="footer-section">
                <h3>Shop Tools</h3>
                <ul class="footer-links">
                    <li><a href="../pages/products.html">All Hardware</a></li>
                    <li><a href="../pages/power-tools.html">Power Tools</a></li>
                    <li><a href="../pages/hand-tools.html">Hand Tools</a></li>
                    <li><a href="../pages/products.html?filter=brand">Shop By Brand</a></li>
                    <li><a href="../pages/products.html?filter=offers">Special Offers</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Services</h3>
                <ul class="footer-links">
                    <li><a href="service-booking.html?service=repair">Tool Repair</a></li>
                    <li><a href="service-booking.html?service=rental">Tool Rental</a></li>
                    <li><a href="service-booking.html?service=sharpening">Blade Sharpening</a></li>
                    <li><a href="service-booking.html?service=custom">Custom Orders</a></li>
                    <li><a href="service-booking.html">Service Plans</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Support</h3>
                <ul class="footer-links">
                    <li><a href="contact.html">Contact Us</a></li>
                    <li><a href="faq.html">FAQ</a></li>
                    <li><a href="warranty.html">Warranty Info</a></li>
                    <li><a href="returns.html">Returns Policy</a></li>
                    <li><a href="user-guides.html">Tool Guides</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Company</h3>
                <ul class="footer-links">
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="locations.html">Store Locations</a></li>
                    <li><a href="careers.html">Careers</a></li>
                    <li><a href="blog.html">DIY Blog</a></li>
                    <li><a href="privacy.html">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 ToolNest Hardware. All rights reserved.</p>
        </div>
    </div>
</footer>

<script>
    // Configure API base URL
    const API_BASE_URL = "http://localhost:8080/api/v1";

    $(document).ready(function() {
        // Initialize header functionality
        initHeader();

        // Setup event listeners
        setupEventListeners();

        // Load user data and page content
        loadUserData();
    });

    /**
     * Initialize the header component
     */
    function initHeader() {
        // Check authentication status and update UI
        checkAuthStatus();

        // Update cart count
        updateCartCount();
    }

    /**
     * Setup all event listeners for the page
     */
    function setupEventListeners() {
        // User dropdown toggle
        $(document).on('click', '.user-account', function(e) {
            e.stopPropagation();
            $('#userDropdown').toggleClass('show');
            $('#backdrop').toggleClass('show');
        });

        // Close dropdown when clicking elsewhere
        $(document).on('click', function() {
            $('#userDropdown').removeClass('show');
            $('#backdrop').removeClass('show');
        });

        // Prevent dropdown from closing when clicking inside it
        $('#userDropdown').on('click', function(e) {
            e.stopPropagation();
        });

        // Sidebar navigation
        $('.sidebar-nav-link').on('click', function(e) {
            e.preventDefault();
            const section = $(this).data('section');
            navigateToSection(section);
        });

        // Logout buttons
        $('#logoutBtn, #sidebarLogoutBtn').on('click', function() {
            logout();
        });

        // Profile form submission
        $('#profileForm').on('submit', function(e) {
            e.preventDefault();
            updateProfile();
        });

        // Password form submission
        $('#passwordForm').on('submit', function(e) {
            e.preventDefault();
            changePassword();
        });
    }

    /**
     * Check if user is authenticated and update UI accordingly
     */
    function checkAuthStatus() {
        const token = localStorage.getItem('token');
        const userEmail = localStorage.getItem('userEmail');

        if (token && userEmail) {
            // User is logged in, fetch user details and update UI
            fetchUserProfile(token, userEmail);
        } else {
            // User is not logged in, redirect to login page
            window.location.href = 'authentication.html?redirect=user-account.html';
        }
    }

    /**
     * Fetch user profile to display name and email
     * @param {string} token - Authentication token
     * @param {string} email - User email
     */
    function fetchUserProfile(token, email) {
        $.ajax({
            url: `${API_BASE_URL}/user/profile`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                if (response.code === 200 && response.data) {
                    // Update UI with user data
                    updateUIForAuthenticatedUser(response.data);
                } else {
                    // If API response is invalid but we have token, still show user interface
                    showDefaultUserInterface(email);
                }
            },
            error: function(xhr) {
                // Only redirect on explicit authentication errors
                if (xhr.status === 401 || xhr.status === 403) {
                    clearAuthData();
                    window.location.href = 'authentication.html?redirect=user-account.html';
                } else {
                    // For other errors, keep user logged in with default info
                    showDefaultUserInterface(email);
                }
            }
        });
    }

    /**
     * Show a default user interface when profile can't be fetched
     * but we know the user is logged in
     * @param {string} email - User email
     */
    function showDefaultUserInterface(email) {
        // Extract initials from email for avatar
        const initials = email.substring(0, 2).toUpperCase();

        // Create user account element with basic info
        const userAccountHtml = `
            <div class="user-account">
                <div class="user-avatar">
                    <span>${initials}</span>
                </div>
                <span class="user-name">Account</span>
                <i class="fas fa-chevron-down" style="margin-left: 5px; font-size: 10px;"></i>
            </div>
        `;

        // Update account container
        $('#accountContainer').html(userAccountHtml);

        // Update user dropdown with minimal info
        $('#userInitials').text(initials);
        $('#userDisplayName').text('My Account');
        $('#userEmail').text(email);

        // Update sidebar
        $('#userAvatar').text(initials);
        $('#userName').text('User');
        $('#userEmail').text(email);
        $('#welcomeName').text('User');
    }

    /**
     * Update UI elements to show authenticated user
     * @param {Object} userData - User profile data
     */
    function updateUIForAuthenticatedUser(userData) {
        // Get first letter of first and last name for avatar
        const firstInitial = userData.firstName ? userData.firstName.charAt(0) : '';
        const lastInitial = userData.lastName ? userData.lastName.charAt(0) : '';
        const initials = (firstInitial + lastInitial).toUpperCase();
        const fullName = `${userData.firstName || ''} ${userData.lastName || ''}`.trim();

        // Create user account element
        const userAccountHtml = `
            <div class="user-account">
                <div class="user-avatar">
                    <span>${initials}</span>
                </div>
                <span class="user-name">${userData.firstName || 'User'}</span>
                <i class="fas fa-chevron-down" style="margin-left: 5px; font-size: 10px;"></i>
            </div>
        `;

        // Update account container
        $('#accountContainer').html(userAccountHtml);

        // Update user dropdown
        $('#userInitials').text(initials);
        $('#userDisplayName').text(fullName);
        $('#userEmail').text(userData.email);

        // Update sidebar
        $('#userAvatar').text(initials);
        $('#userName').text(fullName);
        $('#userEmail').text(userData.email);
        $('#welcomeName').text(userData.firstName || 'User');

        // Populate profile form
        $('#firstName').val(userData.firstName || '');
        $('#lastName').val(userData.lastName || '');
        $('#email').val(userData.email || '');
        $('#phone').val(userData.phoneNumber || '');
    }

    /**
     * Load user data and page content
     */
    function loadUserData() {
        loadDashboardData();
        loadOrdersData();
        loadVehiclesData();
        loadServiceBookingsData();
    }

    /**
     * Load dashboard data
     */
    function loadDashboardData() {
        const token = localStorage.getItem('token');
        if (!token) return;

        // Load orders count
        $.ajax({
            url: `${API_BASE_URL}/orders?page=0&size=1`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                if (response.code === 200 && response.data) {
                    $('#totalOrdersValue').text(response.data.totalElements || 0);

                    // Load recent orders
                    loadRecentOrders();
                }
            }
        });

        // Load services count
        $.ajax({
            url: `${API_BASE_URL}/services?page=0&size=1&status=PENDING`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                if (response.code === 200 && response.data) {
                    $('#upcomingServicesValue').text(response.data.totalElements || 0);
                }
            }
        });

        // Load vehicles count
        $.ajax({
            url: `${API_BASE_URL}/vehicles`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                if (response.code === 200 && response.data) {
                    $('#savedVehiclesValue').text(response.data.length || 0);

                    // Load recent vehicles
                    loadRecentVehicles(response.data);
                }
            }
        });
    }

    /**
     * Load recent orders for dashboard
     */
    function loadRecentOrders() {
        const token = localStorage.getItem('token');
        if (!token) return;

        $.ajax({
            url: `${API_BASE_URL}/orders?page=0&size=3`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                if (response.code === 200 && response.data && response.data.content) {
                    renderRecentOrders(response.data.content);
                } else {
                    // Show empty state
                    $('#recentOrdersList').html('<p>No recent orders found.</p>');
                }
            },
            error: function() {
                $('#recentOrdersList').html('<p>Failed to load recent orders.</p>');
            }
        });
    }

    /**
     * Render recent orders in dashboard
     * @param {Array} orders - Recent orders data
     */
    function renderRecentOrders(orders) {
        const ordersList = $('#recentOrdersList');
        ordersList.empty();

        if (!orders || orders.length === 0) {
            ordersList.html('<p>No recent orders found.</p>');
            return;
        }

        orders.forEach(order => {
            const date = new Date(order.createdAt).toLocaleDateString();
            const statusClass = getStatusClass(order.status);

            const orderItem = `
                <li class="list-item">
                    <div class="item-details">
                        <h4>Order #${order.orderNumber}</h4>
                        <div class="item-meta">${date} â€¢ $${order.total.toFixed(2)}</div>
                    </div>
                    <span class="item-status ${statusClass}">${order.status}</span>
                </li>
            `;

            ordersList.append(orderItem);
        });
    }

    /**
     * Load recent vehicles for dashboard
     * @param {Array} vehicles - User vehicles data
     */
    function loadRecentVehicles(vehicles) {
        const vehiclesList = $('#recentVehiclesList');
        vehiclesList.empty();

        if (!vehicles || vehicles.length === 0) {
            vehiclesList.html('<p>No vehicles found.</p>');
            return;
        }

        // Display up to 3 most recent vehicles
        const recentVehicles = vehicles.slice(0, 3);

        recentVehicles.forEach(vehicle => {
            const vehicleItem = `
                <li class="list-item">
                    <div class="item-details">
                        <h4>${vehicle.year} ${vehicle.make} ${vehicle.model}</h4>
                        <div class="item-meta">${vehicle.ToolSizesFront || 'No Tool size specified'}</div>
                    </div>
                    ${vehicle.isPrimary ? '<span class="item-status status-completed">Default</span>' : ''}
                </li>
            `;

            vehiclesList.append(vehicleItem);
        });
    }

    /**
     * Load orders data
     */
    function loadOrdersData() {
        const token = localStorage.getItem('token');
        if (!token) return;

        $.ajax({
            url: `${API_BASE_URL}/orders?page=0&size=5`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                if (response.code === 200 && response.data) {
                    renderOrders(response.data.content);
                    renderPagination('orders', response.data);
                } else {
                    // Show empty state
                    $('#ordersList').html('<div class="empty-state"><div class="empty-icon">ðŸ“¦</div><p class="empty-text">You have no orders yet.</p></div>');
                }
            },
            error: function() {
                $('#ordersList').html('<p>Failed to load orders.</p>');
            }
        });
    }

    /**
     * Render orders list
     * @param {Array} orders - Orders data
     */
    function renderOrders(orders) {
        const ordersList = $('#ordersList');
        ordersList.empty();

        if (!orders || orders.length === 0) {
            ordersList.html('<div class="empty-state"><div class="empty-icon">ðŸ“¦</div><p class="empty-text">You have no orders yet.</p></div>');
            return;
        }

        orders.forEach(order => {
            const date = new Date(order.createdAt).toLocaleDateString();
            const statusClass = getStatusClass(order.status);

            let productsHtml = '';
            if (order.orderItems && order.orderItems.length > 0) {
                order.orderItems.forEach(item => {
                    productsHtml += `
                        <div class="product-item">
                            <div class="product-image">
                                <img src="${item.productImage || 'https://via.placeholder.com/60x60'}" alt="${item.productName}">
                            </div>
                            <div class="product-details">
                                <div class="product-name">${item.productName}</div>
                                <div class="product-meta">${item.quantity} x $${item.price.toFixed(2)}</div>
                            </div>
                        </div>
                    `;
                });
            }

            const orderItem = `
                <div class="order-item">
                    <div class="order-header">
                        <div class="order-id">Order #${order.orderNumber}</div>
                        <div class="order-date">${date}</div>
                        <span class="order-status ${statusClass}">${order.status}</span>
                    </div>
                    <div class="order-products">
                        ${productsHtml}
                    </div>
                    <div class="order-total">Total: $${order.total.toFixed(2)}</div>
                    <div class="order-actions">
                        <a href="order-details.html?id=${order.id}" class="btn btn-sm">View Details</a>
                    </div>
                </div>
            `;

            ordersList.append(orderItem);
        });
    }

    /**
     * Load vehicles data
     */
    function loadVehiclesData() {
        const token = localStorage.getItem('token');
        if (!token) return;

        $.ajax({
            url: `${API_BASE_URL}/vehicles`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                if (response.code === 200 && response.data) {
                    renderVehicles(response.data);
                } else {
                    // Show empty state
                    $('#vehiclesGrid').html('<div class="empty-state"><div class="empty-icon">ðŸš—</div><p class="empty-text">You have no vehicles yet.</p></div>');
                }
            },
            error: function() {
                $('#vehiclesGrid').html('<p>Failed to load vehicles.</p>');
            }
        });
    }

    /**
     * Render vehicles grid
     * @param {Array} vehicles - Vehicles data
     */
    function renderVehicles(vehicles) {
        const vehiclesGrid = $('#vehiclesGrid');
        vehiclesGrid.empty();

        if (!vehicles || vehicles.length === 0) {
            vehiclesGrid.html('<div class="empty-state"><div class="empty-icon">ðŸš—</div><p class="empty-text">You have no vehicles yet.</p></div>');
            return;
        }

        vehicles.forEach(vehicle => {
            const vehicleCard = `
                <div class="vehicle-card ${vehicle.isPrimary ? 'default' : ''}">
                    <h3 class="vehicle-title">${vehicle.year} ${vehicle.make} ${vehicle.model}</h3>
                    <div class="vehicle-details">
                        <div class="detail-row">
                            <div class="detail-label">Make:</div>
                            <div class="detail-value">${vehicle.make}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Model:</div>
                            <div class="detail-value">${vehicle.model}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Year:</div>
                            <div class="detail-value">${vehicle.year}</div>
                        </div>
                        ${vehicle.trim ? `
                        <div class="detail-row">
                            <div class="detail-label">Trim:</div>
                            <div class="detail-value">${vehicle.trim}</div>
                        </div>
                        ` : ''}
                        <div class="detail-row">
                            <div class="detail-label">Tool Size:</div>
                            <div class="detail-value">${vehicle.ToolSizesFront || 'Not specified'}</div>
                        </div>
                    </div>
                    <div class="vehicle-actions">
                        <a href="Tool-finder.html?vehicle=${vehicle.id}" class="btn btn-sm">Find Tools</a>
                        <button class="btn btn-sm btn-outline edit-vehicle-btn" data-id="${vehicle.id}">Edit</button>
                        ${!vehicle.isPrimary ? `<button class="btn btn-sm btn-outline set-default-btn" data-id="${vehicle.id}">Set as Default</button>` : ''}
                    </div>
                </div>
            `;

            vehiclesGrid.append(vehicleCard);
        });

        // Add "Add New Vehicle" card
        const addVehicleCard = `
            <a href="user-vehicles.html" class="add-vehicle-btn">
                <span class="add-icon">+</span>
                <h3>Add New Vehicle</h3>
                <p>Add another vehicle to your account</p>
            </a>
        `;

        vehiclesGrid.append(addVehicleCard);
    }

    /**
     * Load service bookings data
     */
    function loadServiceBookingsData() {
        const token = localStorage.getItem('token');
        if (!token) return;

        $.ajax({
            url: `${API_BASE_URL}/services?page=0&size=5`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                if (response.code === 200 && response.data) {
                    renderServiceBookings(response.data.content);
                    renderPagination('services', response.data);
                } else {
                    // Show empty state
                    $('#serviceBookingsList').html('<div class="empty-state"><div class="empty-icon">ðŸ”§</div><p class="empty-text">You have no service bookings yet.</p></div>');
                }
            },
            error: function() {
                $('#serviceBookingsList').html('<p>Failed to load service bookings.</p>');
            }
        });
    }

    /**
     * Render service bookings list
     * @param {Array} bookings - Service bookings data
     */
    function renderServiceBookings(bookings) {
        const bookingsList = $('#serviceBookingsList');
        bookingsList.empty();

        if (!bookings || bookings.length === 0) {
            bookingsList.html('<div class="empty-state"><div class="empty-icon">ðŸ”§</div><p class="empty-text">You have no service bookings yet.</p></div>');
            return;
        }

        bookings.forEach(booking => {
            const date = new Date(booking.date).toLocaleDateString();
            const time = booking.time;
            const statusClass = getStatusClass(booking.status);

            const bookingItem = `
                <div class="service-item">
                    <div class="service-header">
                        <div class="service-id">Booking #${booking.bookingNumber}</div>
                        <div class="service-date">${date} at ${time}</div>
                        <span class="item-status ${statusClass}">${booking.status}</span>
                    </div>
                    <div class="service-details">
                        <div class="service-vehicle">${booking.vehicleInfo}</div>
                        <div class="service-type">Service: ${booking.serviceTypeName}</div>
                        <div class="service-price">Price: $${booking.price.toFixed(2)}</div>
                    </div>
                    <div class="order-actions">
                        <a href="service-booking-details.html?id=${booking.id}" class="btn btn-sm">View Details</a>
                        ${booking.status === 'PENDING' ? `<button class="btn btn-sm btn-outline cancel-booking-btn" data-id="${booking.id}">Cancel</button>` : ''}
                    </div>
                </div>
            `;

            bookingsList.append(bookingItem);
        });
    }

    /**
     * Render pagination for lists
     * @param {string} type - Type of pagination ('orders' or 'services')
     * @param {Object} pageData - Pagination data from API
     */
    function renderPagination(type, pageData) {
        const paginationId = type === 'orders' ? 'ordersPagination' : 'servicesPagination';
        const pagination = $(`#${paginationId}`);
        pagination.empty();

        if (!pageData || pageData.totalPages <= 1) {
            return;
        }

        const currentPage = pageData.number;
        const totalPages = pageData.totalPages;

        // Previous button
        pagination.append(`
            <a href="#" class="pagination-btn ${currentPage === 0 ? 'disabled' : ''}" data-page="${currentPage - 1}" ${currentPage === 0 ? 'disabled' : ''}>
                <i class="fas fa-chevron-left"></i>
            </a>
        `);

        // Page numbers
        for (let i = 0; i < totalPages; i++) {
            pagination.append(`
                <a href="#" class="pagination-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">
                    ${i + 1}
                </a>
            `);
        }

        // Next button
        pagination.append(`
            <a href="#" class="pagination-btn ${currentPage === totalPages - 1 ? 'disabled' : ''}" data-page="${currentPage + 1}" ${currentPage === totalPages - 1 ? 'disabled' : ''}>
                <i class="fas fa-chevron-right"></i>
            </a>
        `);

        // Add click handlers
        pagination.find('.pagination-btn:not(.disabled)').on('click', function(e) {
            e.preventDefault();
            const page = $(this).data('page');

            if (type === 'orders') {
                loadOrdersPage(page);
            } else {
                loadServicesPage(page);
            }
        });
    }

    /**
     * Load specific page of orders
     * @param {number} page - Page number to load
     */
    function loadOrdersPage(page) {
        const token = localStorage.getItem('token');
        if (!token) return;

        // Show loading spinner
        $('#ordersList').html('<div class="spinner-container"><div class="spinner"></div></div>');

        $.ajax({
            url: `${API_BASE_URL}/orders?page=${page}&size=5`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                if (response.code === 200 && response.data) {
                    renderOrders(response.data.content);
                    renderPagination('orders', response.data);
                }
            },
            error: function() {
                $('#ordersList').html('<p>Failed to load orders.</p>');
            }
        });
    }

    /**
     * Load specific page of service bookings
     * @param {number} page - Page number to load
     */
    function loadServicesPage(page) {
        const token = localStorage.getItem('token');
        if (!token) return;

        // Show loading spinner
        $('#serviceBookingsList').html('<div class="spinner-container"><div class="spinner"></div></div>');

        $.ajax({
            url: `${API_BASE_URL}/services?page=${page}&size=5`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                if (response.code === 200 && response.data) {
                    renderServiceBookings(response.data.content);
                    renderPagination('services', response.data);
                }
            },
            error: function() {
                $('#serviceBookingsList').html('<p>Failed to load service bookings.</p>');
            }
        });
    }

    /**
     * Update user profile
     */
    function updateProfile() {
        const token = localStorage.getItem('token');
        if (!token) return;

        const userData = {
            firstName: $('#firstName').val(),
            lastName: $('#lastName').val(),
            email: $('#email').val(),
            phoneNumber: $('#phone').val()
        };

        $.ajax({
            url: `${API_BASE_URL}/user/update-profile`,
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            data: JSON.stringify(userData),
            success: function(response) {
                if (response.code === 200) {
                    showAlert('success', 'Profile updated successfully!');

                    // Update displayed user info
                    const fullName = `${userData.firstName} ${userData.lastName}`;
                    const initials = (userData.firstName.charAt(0) + userData.lastName.charAt(0)).toUpperCase();

                    $('#userName').text(fullName);
                    $('#userAvatar').text(initials);
                    $('#welcomeName').text(userData.firstName);

                    // Update header user info
                    $('#userDisplayName').text(fullName);
                    $('#userInitials').text(initials);
                } else {
                    showAlert('error', response.message || 'Failed to update profile');
                }
            },
            error: function(xhr) {
                showAlert('error', xhr.responseJSON?.message || 'Failed to update profile');
            }
        });
    }

    /**
     * Change user password
     */
    function changePassword() {
        const token = localStorage.getItem('token');
        if (!token) return;

        const currentPassword = $('#currentPassword').val();
        const newPassword = $('#newPassword').val();
        const confirmPassword = $('#confirmPassword').val();

        // Validate passwords match
        if (newPassword !== confirmPassword) {
            showAlert('error', 'New passwords do not match');
            $('#confirmPasswordError').text('Passwords do not match').addClass('visible');
            return;
        }

        const passwordData = {
            oldPassword: currentPassword,
            newPassword: newPassword
        };

        $.ajax({
            url: `${API_BASE_URL}/user/change-password`,
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            data: JSON.stringify(passwordData),
            success: function(response) {
                if (response.code === 200) {
                    showAlert('success', 'Password changed successfully!');

                    // Clear password form
                    $('#passwordForm')[0].reset();
                } else {
                    showAlert('error', response.message || 'Failed to change password');
                }
            },
            error: function(xhr) {
                if (xhr.status === 401) {
                    $('#currentPasswordError').text('Current password is incorrect').addClass('visible');
                } else {
                    showAlert('error', xhr.responseJSON?.message || 'Failed to change password');
                }
            }
        });
    }

    /**
     * Navigate to a specific section in the account page
     * @param {string} section - Section identifier
     */
    function navigateToSection(section) {
        // Remove active class from all sections and nav links
        $('.content-section').removeClass('active');
        $('.sidebar-nav-link').removeClass('active');

        // Add active class to selected section and nav link
        $(`#${section}Section`).addClass('active');
        $(`.sidebar-nav-link[data-section="${section}"]`).addClass('active');
    }

    /**
     * Get CSS class for order/service status
     * @param {string} status - Status value
     * @returns {string} CSS class for the status
     */
    function getStatusClass(status) {
        switch (status) {
            case 'PENDING':
                return 'status-pending';
            case 'PAID':
            case 'PROCESSING':
            case 'IN_PROGRESS':
            case 'CONFIRMED':
                return 'status-processing';
            case 'SHIPPED':
            case 'DELIVERED':
            case 'COMPLETED':
                return 'status-completed';
            case 'CANCELLED':
                return 'status-cancelled';
            default:
                return '';
        }
    }

    /**
     * Update cart count in header
     */
    function updateCartCount() {
        // Check if user is logged in
        if (isAuthenticated()) {
            const token = localStorage.getItem('token');
            // Get cart from API
            $.ajax({
                url: `${API_BASE_URL}/cart`,
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token
                },
                success: function(response) {
                    if (response.code === 200) {
                        const totalItems = response.data.totalItems || 0;
                        updateCartBadge(totalItems);
                    }
                },
                error: function(xhr) {
                    console.error('Error retrieving cart:', xhr.status);
                    // For errors, just show 0 or use localStorage as fallback
                    updateCartFromLocalStorage();
                }
            });
        } else {
            // Update from localStorage for non-logged in users
            updateCartFromLocalStorage();
        }
    }

    /**
     * Update cart count from localStorage
     */
    function updateCartFromLocalStorage() {
        try {
            const cartData = localStorage.getItem('cart');
            if (cartData) {
                const cart = JSON.parse(cartData);
                updateCartBadge(cart.totalItems || 0);
            } else {
                updateCartBadge(0);
            }
        } catch (e) {
            console.error('Error parsing cart from localStorage', e);
            updateCartBadge(0);
        }
    }

    /**
     * Update cart badge in navigation
     * @param {number} count - Number of items in cart
     */
    function updateCartBadge(count) {
        $('#cartCount').text(count);
    }

    /**
     * Check if user is authenticated
     * @returns {boolean} True if user is authenticated
     */
    function isAuthenticated() {
        return !!localStorage.getItem('token');
    }

    /**
     * Clear authentication data from localStorage
     */
    function clearAuthData() {
        localStorage.removeItem('token');
        localStorage.removeItem('userEmail');
    }

    /**
     * Handle user logout
     */
    function logout() {
        const token = localStorage.getItem('token');

        if (token) {
            // Call logout API endpoint
            $.ajax({
                url: `${API_BASE_URL}/auth/logout`,
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                complete: function() {
                    // Clear auth data and redirect to login
                    clearAuthData();
                    window.location.href = 'authentication.html';
                }
            });
        } else {
            // If no token found, just redirect to login
            window.location.href = 'authentication.html';
        }
    }

    /**
     * Show alert message
     * @param {string} type - Alert type ('success' or 'error')
     * @param {string} message - Alert message
     */
    function showAlert(type, message) {
        const alertId = type === 'success' ? 'alertSuccess' : 'alertError';
        const alertElement = $(`#${alertId}`);

        alertElement.text(message);
        alertElement.addClass('show');

        // Scroll to top to show alert
        window.scrollTo({ top: 0, behavior: 'smooth' });

        // Auto-hide after 5 seconds
        setTimeout(() => {
            alertElement.removeClass('show');
        }, 5000);
    }
</script>
</body>
</html>