<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool Finder | ToolNest</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <script src="../js/common.js"></script>
    <link href="../css/common.css" rel="stylesheet">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/animate.css" rel="stylesheet">
    <link href="../css/tool.css" rel="stylesheet">
    <link href="../css/mediaquery.css" rel="stylesheet">



    <!-- animate -->
    <link rel='stylesheet' href="../css/animate.min.css">
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #222831;
            --secondary: #D65A31;
            --light-gray: #EEEEEE;
            --dark-gray: #393E46;
            --success: #28a745;
            --error: #dc3545;
            --info: #17a2b8;
        }

        body {
            background-color: var(--light-gray);
            color: var(--primary);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: #bf4f2c;
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .btn-outline {
            background-color: transparent;
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .btn-outline:hover {
            background-color: var(--light-gray);
        }

        /* Header Styles */
        header {
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        /* Page Title */
        .page-title {
            background-color: var(--primary);
            color: white;
            padding: 40px 0;
            margin-bottom: 30px;
        }

        .page-title h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .page-title p {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Tool Finder Section */
        .Tool-finder {
            max-width: 900px;
            margin: 0 auto 50px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Finder Tabs */
        .finder-tabs {
            display: flex;
            border-bottom: 1px solid var(--light-gray);
        }

        .finder-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .finder-tab.active {
            color: var(--secondary);
            border-bottom: 3px solid var(--secondary);
        }

        /* Finder Contents */
        .finder-content {
            display: none;
            padding: 30px;
        }

        .finder-content.active {
            display: block;
        }

        /* Vehicle Search */
        .vehicle-search-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-row.triple {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .form-control.error {
            border-color: var(--error);
        }

        .error-message {
            color: var(--error);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .error-message.visible {
            display: block;
        }

        .form-actions {
            text-align: center;
            margin-top: 30px;
        }

        /* Tool Size Search */
        .Tool-size-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .size-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .size-selector-full {
            grid-column: 1 / 4;
        }

        .size-help {
            text-align: center;
            margin-bottom: 20px;
        }

        .size-diagram {
            max-width: 100%;
            height: auto;
            margin: 0 auto 20px;
            display: block;
        }

        /* Loading Spinner */
        .spinner-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
            width: 100%;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--secondary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Results Section */
        .results-section {
            margin-bottom: 50px;
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .results-count {
            color: var(--dark-gray);
        }

        .filter-controls {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .filter-label {
            font-weight: 600;
        }

        .filter-select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .product-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .product-image {
            height: 200px;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-info {
            padding: 20px;
        }

        .product-title {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .product-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-bottom: 10px;
        }

        .product-rating {
            display: flex;
            margin-bottom: 15px;
        }

        .star {
            color: gold;
            margin-right: 2px;
        }

        .product-price {
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 50px 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .no-results-icon {
            font-size: 3rem;
            color: var(--dark-gray);
            margin-bottom: 20px;
        }

        .no-results-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .no-results-message {
            color: var(--dark-gray);
            margin-bottom: 30px;
        }

        /* Vehicle Suggestions */
        .vehicle-suggestions {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            position: absolute;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            z-index: 10;
            display: none;
        }

        .vehicle-suggestions.show {
            display: block;
        }

        .suggestion-item {
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .suggestion-item:hover {
            background-color: var(--light-gray);
        }

        /* Info Popups */
        .info-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background-color: var(--info);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .info-popup {
            position: relative;
            display: inline-block;
        }

        .info-Tooltip {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            background-color: var(--primary);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 20;
            display: none;
        }

        .info-Tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--primary) transparent transparent transparent;
        }

        .info-popup:hover .info-Tooltip {
            display: block;
        }

        /* Alerts */
        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .alert-error {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--error);
            border: 1px solid var(--error);
        }

        .alert-info {
            background-color: rgba(23, 162, 184, 0.1);
            color: var(--info);
            border: 1px solid var(--info);
        }

        /* Footer */
        footer {
            background-color: var(--primary);
            color: white;
            padding: 50px 0 20px;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .form-row,
            .form-row.triple {
                grid-template-columns: 1fr;
            }

            .finder-tabs {
                flex-direction: column;
            }

            .finder-tab {
                border-bottom: 1px solid var(--light-gray);
            }

            .finder-tab.active {
                border-bottom: 1px solid var(--secondary);
            }

            .size-selector {
                grid-template-columns: 1fr;
            }

            .size-selector-full {
                grid-column: auto;
            }

            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .filter-controls {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
<!-- Header Section -->
<header>
    <div class="container header-container">
        <a href="../index.html" class="logo">Tool<span>Nest</span></a>
        <form id="searchForm" class="search-bar">
            <input type="text" id="searchInput" placeholder="Search for Tools...">
            <button type="submit"><i class="fas fa-search"></i></button>
        </form>
        <button class="mobile-menu-btn">‚ò∞</button>
        <ul class="nav-links">
            <li><a href="products.html" class="active">Shop</a></li>
            <li><a href="tool-finder.html">Tool Finder</a></li>
            <li><a href="cart.html">Cart (0)</a></li>
            <li><a href="authentication.html">Sign In</a></li>
        </ul>
    </div>
</header>


<!-- Page Title -->
<section class="page-title">
    <div class="container">
        <h1>Find Your Perfect Tools</h1>
        <p>Enter your vehicle details or Tool size to find the right Tools for your needs</p>
    </div>
</section>

<!-- Main Content -->
<div class="container">
    <!-- Alerts -->
    <div class="alert alert-success" id="alertSuccess"></div>
    <div class="alert alert-error" id="alertError"></div>
    <div class="alert alert-info" id="alertInfo"></div>

    <!-- Tool Finder -->
    <div class="Tool-finder">
        <div class="finder-tabs">
            <div class="finder-tab active" data-tab="vehicle">Search by Vehicle</div>
            <div class="finder-tab" data-tab="size">Search by Tool Size</div>
        </div>

        <div class="finder-contents">
            <!-- Vehicle Search -->
            <div class="finder-content active" id="vehicleContent">
                <form class="vehicle-search-form" id="vehicleSearchForm">
                    <div class="form-row triple">
                        <div class="form-group">
                            <label for="vehicleMake" class="form-label">Make</label>
                            <div style="position: relative;">
                                <input type="text" id="vehicleMake" class="form-control" placeholder="e.g. Toyota" required>
                                <div class="vehicle-suggestions" id="makeSuggestions"></div>
                            </div>
                            <div class="error-message" id="vehicleMakeError"></div>
                        </div>
                        <div class="form-group">
                            <label for="vehicleModel" class="form-label">Model</label>
                            <div style="position: relative;">
                                <input type="text" id="vehicleModel" class="form-control" placeholder="e.g. Camry" required>
                                <div class="vehicle-suggestions" id="modelSuggestions"></div>
                            </div>
                            <div class="error-message" id="vehicleModelError"></div>
                        </div>
                        <div class="form-group">
                            <label for="vehicleYear" class="form-label">Year</label>
                            <select id="vehicleYear" class="form-control" required>
                                <option value="">Select Year</option>
                                <!-- Years will be dynamically generated -->
                            </select>
                            <div class="error-message" id="vehicleYearError"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="vehicleTrim" class="form-label">Trim (Optional)</label>
                        <select id="vehicleTrim" class="form-control">
                            <option value="">Select Trim</option>
                            <!-- Trims will be dynamically generated -->
                        </select>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn" id="findToolsBtn">Find Matching Tools</button>
                    </div>
                </form>
            </div>

            <!-- Tool Size Search -->
            <div class="finder-content" id="sizeContent">
                <div class="size-help">
                    <img src="https://via.placeholder.com/600x200?text=Tool+Size+Diagram" alt="Tool Size Diagram" class="size-diagram">
                    <p>Please enter your Tool size information as shown on the sidewall of your Tool.</p>
                </div>

                <form class="Tool-size-form" id="ToolSizeForm">
                    <div class="size-selector">
                        <div class="form-group">
                            <label for="ToolWidth" class="form-label">
                                Width
                                <div class="info-popup">
                                    <span class="info-icon">i</span>
                                    <div class="info-Tooltip">The width of the Tool in millimeters.</div>
                                </div>
                            </label>
                            <input type="number" id="ToolWidth" class="form-control" placeholder="e.g. 205" required min="0" max="500">
                            <div class="error-message" id="ToolWidthError"></div>
                        </div>

                        <div class="form-group">
                            <label for="aspectRatio" class="form-label">
                                Aspect Ratio
                                <div class="info-popup">
                                    <span class="info-icon">i</span>
                                    <div class="info-Tooltip">The ratio of the Tool's height to its width.</div>
                                </div>
                            </label>
                            <input type="number" id="aspectRatio" class="form-control" placeholder="e.g. 55" required min="0" max="100">
                            <div class="error-message" id="aspectRatioError"></div>
                        </div>

                        <div class="form-group">
                            <label for="wheelDiameter" class="form-label">
                                Wheel Diameter
                                <div class="info-popup">
                                    <span class="info-icon">i</span>
                                    <div class="info-Tooltip">The diameter of the wheel in inches.</div>
                                </div>
                            </label>
                            <input type="number" id="wheelDiameter" class="form-control" placeholder="e.g. 16" required min="0" max="30">
                            <div class="error-message" id="wheelDiameterError"></div>
                        </div>

                        <div class="form-group size-selector-full">
                            <label class="form-label">Complete Tool Size</label>
                            <div style="display: flex; align-items: center; gap: 5px; font-size: 1.2rem; justify-content: center;">
                                <span id="sizePreview">205/55R16</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn" id="findToolsBySizeBtn">Find Matching Tools</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="results-section" id="resultsSection">
        <div class="results-header">
            <div>
                <h2 class="results-title">Matching Tools</h2>
                <p class="results-count" id="resultsCount">0 products found</p>
            </div>
            <div>
                <button class="btn btn-outline" id="modifySearchBtn">Modify Search</button>
            </div>
        </div>

        <div class="filter-controls">
            <div class="filter-label">Filter By:</div>

            <select id="brandFilter" class="filter-select">
                <option value="">All Brands</option>
                <!-- Brands will be dynamically generated -->
            </select>

            <select id="typeFilter" class="filter-select">
                <option value="">All Types</option>
                <option value="all-season">All Season</option>
                <option value="summer">Summer</option>
                <option value="winter">Winter</option>
                <option value="all-terrain">All Terrain</option>
                <option value="performance">Performance</option>
            </select>

            <select id="priceFilter" class="filter-select">
                <option value="">All Prices</option>
                <option value="0-100">Under $100</option>
                <option value="100-150">$100 - $150</option>
                <option value="150-200">$150 - $200</option>
                <option value="200-1000">Over $200</option>
            </select>

            <select id="sortFilter" class="filter-select">
                <option value="recommended">Recommended</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
                <option value="rating">Highest Rated</option>
                <option value="popularity">Most Popular</option>
            </select>
        </div>

        <div id="resultsContainer">
            <!-- Loading spinner -->
            <div class="spinner-container">
                <div class="spinner"></div>
            </div>
        </div>
    </div>
</div>

<!-- Footer Section -->
<footer>
    <div class="container">
        <div class="footer-container">
            <div class="footer-section">
                <h3>Shop Tools</h3>
                <ul class="footer-links">
                    <li><a href="../pages/products.html">All Hardware</a></li>
                    <li><a href="../pages/power-tools.html">Power Tools</a></li>
                    <li><a href="../pages/hand-tools.html">Hand Tools</a></li>
                    <li><a href="../pages/products.html?filter=brand">Shop By Brand</a></li>
                    <li><a href="../pages/products.html?filter=offers">Special Offers</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Services</h3>
                <ul class="footer-links">
                    <li><a href="service-booking.html?service=repair">Tool Repair</a></li>
                    <li><a href="service-booking.html?service=rental">Tool Rental</a></li>
                    <li><a href="service-booking.html?service=sharpening">Blade Sharpening</a></li>
                    <li><a href="service-booking.html?service=custom">Custom Orders</a></li>
                    <li><a href="service-booking.html">Service Plans</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Support</h3>
                <ul class="footer-links">
                    <li><a href="contact.html">Contact Us</a></li>
                    <li><a href="faq.html">FAQ</a></li>
                    <li><a href="warranty.html">Warranty Info</a></li>
                    <li><a href="returns.html">Returns Policy</a></li>
                    <li><a href="user-guides.html">Tool Guides</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Company</h3>
                <ul class="footer-links">
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="locations.html">Store Locations</a></li>
                    <li><a href="careers.html">Careers</a></li>
                    <li><a href="blog.html">DIY Blog</a></li>
                    <li><a href="privacy.html">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 ToolNest Hardware. All rights reserved.</p>
        </div>
    </div>
</footer>

<!-- Include Common Nav/Footer -->
<script src="js/common.js"></script>

<!-- Tool Finder Page Specific Scripts -->
<script>
    // Global state
    let searchResults = [];
    let makes = [];
    let models = [];
    let trims = [];

    // Search parameters
    let searchParams = {
        make: '',
        model: '',
        year: '',
        trim: '',
        ToolSize: ''
    };

    // Filter parameters
    let filterParams = {
        brand: '',
        type: '',
        priceRange: '',
        sort: 'recommended'
    };

    document.addEventListener('DOMContentLoaded', function() {
        // Setup Tool finder tabs
        setupTabs();

        // Setup vehicle search form
        setupVehicleSearch();

        // Setup Tool size search form
        setupToolSizeSearch();

        // Setup filter controls
        setupFilters();

        // Populate year dropdown
        populateYearDropdown();

        // Setup modify search button
        document.getElementById('modifySearchBtn').addEventListener('click', function() {
            // Hide results section
            document.getElementById('resultsSection').classList.remove('show');

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    });

    /**
     * Setup Tool finder tabs
     */
    function setupTabs() {
        const tabs = document.querySelectorAll('.finder-tab');

        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                tabs.forEach(t => t.classList.remove('active'));

                // Add active class to clicked tab
                this.classList.add('active');

                // Hide all tab contents
                document.querySelectorAll('.finder-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Show selected tab content
                const tabId = this.getAttribute('data-tab');
                document.getElementById(`${tabId}Content`).classList.add('active');
            });
        });
    }

    /**
     * Setup vehicle search form
     */
    function setupVehicleSearch() {
        const vehicleSearchForm = document.getElementById('vehicleSearchForm');
        const vehicleMakeInput = document.getElementById('vehicleMake');
        const vehicleModelInput = document.getElementById('vehicleModel');
        const vehicleYearSelect = document.getElementById('vehicleYear');
        const vehicleTrimSelect = document.getElementById('vehicleTrim');

        // Setup make input with auto-suggestions
        vehicleMakeInput.addEventListener('input', function() {
            const query = this.value.trim();

            if (query.length >= 2) {
                // Fetch makes matching query
                fetchMakes(query);
            } else {
                // Hide suggestions
                document.getElementById('makeSuggestions').classList.remove('show');
            }
        });

        // Setup model input with auto-suggestions
        vehicleModelInput.addEventListener('input', function() {
            const query = this.value.trim();
            const make = vehicleMakeInput.value.trim();

            if (query.length >= 2 && make) {
                // Fetch models matching query for selected make
                fetchModels(make, query);
            } else {
                // Hide suggestions
                document.getElementById('modelSuggestions').classList.remove('show');
            }
        });

        // Setup year select change event
        vehicleYearSelect.addEventListener('change', function() {
            const make = vehicleMakeInput.value.trim();
            const model = vehicleModelInput.value.trim();
            const year = this.value;

            if (make && model && year) {
                // Fetch trims for selected vehicle
                fetchTrims(make, model, year);
            }
        });

        // Form submission
        vehicleSearchForm.addEventListener('submit', function(e) {
            e.preventDefault();

            // Validate form
            if (validateVehicleForm()) {
                // Get form values
                const make = vehicleMakeInput.value.trim();
                const model = vehicleModelInput.value.trim();
                const year = vehicleYearSelect.value;
                const trim = vehicleTrimSelect.value;

                // Update search parameters
                searchParams.make = make;
                searchParams.model = model;
                searchParams.year = year;
                searchParams.trim = trim;
                searchParams.ToolSize = '';

                // Search for matching Tools
                searchTools('vehicle');
            }
        });
    }

    /**
     * Setup Tool size search form
     */
    function setupToolSizeSearch() {
        const ToolSizeForm = document.getElementById('ToolSizeForm');
        const ToolWidthInput = document.getElementById('ToolWidth');
        const aspectRatioInput = document.getElementById('aspectRatio');
        const wheelDiameterInput = document.getElementById('wheelDiameter');
        const sizePreview = document.getElementById('sizePreview');

        // Update size preview as user types
        function updateSizePreview() {
            const width = ToolWidthInput.value || '205';
            const ratio = aspectRatioInput.value || '55';
            const diameter = wheelDiameterInput.value || '16';

            sizePreview.textContent = `${width}/${ratio}R${diameter}`;
        }

        ToolWidthInput.addEventListener('input', updateSizePreview);
        aspectRatioInput.addEventListener('input', updateSizePreview);
        wheelDiameterInput.addEventListener('input', updateSizePreview);

        // Form submission
        ToolSizeForm.addEventListener('submit', function(e) {
            e.preventDefault();

            // Validate form
            if (validateToolSizeForm()) {
                // Get form values
                const width = ToolWidthInput.value;
                const ratio = aspectRatioInput.value;
                const diameter = wheelDiameterInput.value;

                // Construct Tool size string
                const ToolSize = `${width}/${ratio}R${diameter}`;

                // Update search parameters
                searchParams.make = '';
                searchParams.model = '';
                searchParams.year = '';
                searchParams.trim = '';
                searchParams.ToolSize = ToolSize;

                // Search for matching Tools
                searchTools('size');
            }
        });
    }

    /**
     * Setup filter controls
     */
    function setupFilters() {
        const brandFilter = document.getElementById('brandFilter');
        const typeFilter = document.getElementById('typeFilter');
        const priceFilter = document.getElementById('priceFilter');
        const sortFilter = document.getElementById('sortFilter');

        // Add change event listeners
        brandFilter.addEventListener('change', function() {
            filterParams.brand = this.value;
            applyFilters();
        });

        typeFilter.addEventListener('change', function() {
            filterParams.type = this.value;
            applyFilters();
        });

        priceFilter.addEventListener('change', function() {
            filterParams.priceRange = this.value;
            applyFilters();
        });

        sortFilter.addEventListener('change', function() {
            filterParams.sort = this.value;
            applyFilters();
        });
    }

    /**
     * Populate year dropdown with recent years
     */
    function populateYearDropdown() {
        const yearSelect = document.getElementById('vehicleYear');
        const currentYear = new Date().getFullYear();

        // Clear existing options except placeholder
        while (yearSelect.options.length > 1) {
            yearSelect.remove(1);
        }

        // Add years from current year down to 1990
        for (let year = currentYear + 1; year >= 1990; year--) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            yearSelect.appendChild(option);
        }
    }

    /**
     * Fetch makes matching query
     * @param {string} query Search query
     */
    function fetchMakes(query) {
        // In a real application, you would fetch from an API
        // For this demo, we'll use mock data
        const mockMakes = [
            'Acura', 'Audi', 'BMW', 'Buick', 'Cadillac', 'Chevrolet', 'Chrysler',
            'Dodge', 'Ford', 'GMC', 'Honda', 'Hyundai', 'Infiniti', 'Jaguar',
            'Jeep', 'Kia', 'Land Rover', 'Lexus', 'Lincoln', 'Mazda', 'Mercedes-Benz',
            'Mitsubishi', 'Nissan', 'Porsche', 'Ram', 'Subaru', 'Toyota', 'Volkswagen', 'Volvo'
        ];

        // Filter makes by query
        const filteredMakes = mockMakes.filter(make =>
            make.toLowerCase().includes(query.toLowerCase())
        );

        // Store filtered makes
        makes = filteredMakes;

        // Show suggestions
        showSuggestions('make', filteredMakes);
    }

    /**
     * Fetch models matching query for selected make
     * @param {string} make Vehicle make
     * @param {string} query Search query
     */
    function fetchModels(make, query) {
        // In a real application, you would fetch from an API
        // For this demo, we'll use mock data based on selected make
        let mockModels = [];

        switch (make.toLowerCase()) {
            case 'toyota':
                mockModels = ['Camry', 'Corolla', 'RAV4', 'Highlander', 'Tacoma', 'Tundra', 'Prius', 'Sienna', '4Runner', 'Avalon'];
                break;
            case 'honda':
                mockModels = ['Accord', 'Civic', 'CR-V', 'Pilot', 'Odyssey', 'HR-V', 'Ridgeline', 'Fit', 'Passport', 'Insight'];
                break;
            case 'ford':
                mockModels = ['F-150', 'Escape', 'Explorer', 'Mustang', 'Edge', 'Expedition', 'Ranger', 'Bronco', 'Fusion', 'Focus'];
                break;
            case 'chevrolet':
                mockModels = ['Silverado', 'Equinox', 'Tahoe', 'Traverse', 'Malibu', 'Suburban', 'Colorado', 'Trax', 'Blazer', 'Camaro'];
                break;
            case 'bmw':
                mockModels = ['3 Series', '5 Series', 'X3', 'X5', '7 Series', 'X1', 'X7', '4 Series', '8 Series', 'i4'];
                break;
            default:
                mockModels = ['Model 1', 'Model 2', 'Model 3', 'Sedan', 'SUV', 'Truck', 'Compact', 'Crossover'];
        }

        // Filter models by query
        const filteredModels = mockModels.filter(model =>
            model.toLowerCase().includes(query.toLowerCase())
        );

        // Store filtered models
        models = filteredModels;

        // Show suggestions
        showSuggestions('model', filteredModels);
    }

    /**
     * Fetch trims for selected vehicle
     * @param {string} make Vehicle make
     * @param {string} model Vehicle model
     * @param {string} year Vehicle year
     */
    function fetchTrims(make, model, year) {
        // In a real application, you would fetch from an API
        // For this demo, we'll use mock data
        const mockTrims = [];

        // Generate some mock trims based on make and model
        if (make.toLowerCase() === 'toyota' && model.toLowerCase() === 'camry') {
            mockTrims.push('L', 'LE', 'SE', 'XLE', 'XSE', 'TRD', 'Hybrid LE', 'Hybrid SE', 'Hybrid XLE');
        } else if (make.toLowerCase() === 'honda' && model.toLowerCase() === 'accord') {
            mockTrims.push('LX', 'Sport', 'Sport SE', 'EX-L', 'Touring', 'Hybrid', 'Hybrid EX', 'Hybrid EX-L');
        } else if (make.toLowerCase() === 'ford' && model.toLowerCase() === 'f-150') {
            mockTrims.push('XL', 'XLT', 'Lariat', 'King Ranch', 'Platinum', 'Limited', 'Raptor', 'Tremor');
        } else {
            mockTrims.push('Base', 'Sport', 'Luxury', 'Premium', 'Limited', 'GT', 'Touring');
        }

        // Store trims
        trims = mockTrims;

        // Update trim dropdown
        updateTrimDropdown(mockTrims);
    }

    /**
     * Update trim dropdown with fetched trims
     * @param {Array} trims Array of trim options
     */
    function updateTrimDropdown(trims) {
        const trimSelect = document.getElementById('vehicleTrim');

        // Clear existing options except placeholder
        while (trimSelect.options.length > 1) {
            trimSelect.remove(1);
        }

        // Add new trim options
        trims.forEach(trim => {
            const option = document.createElement('option');
            option.value = trim;
            option.textContent = trim;
            trimSelect.appendChild(option);
        });
    }

    /**
     * Show suggestions dropdown
     * @param {string} type Type of suggestions ('make' or 'model')
     * @param {Array} suggestions Array of suggestion items
     */
    function showSuggestions(type, suggestions) {
        const suggestionsContainer = document.getElementById(`${type}Suggestions`);

        // Clear container
        suggestionsContainer.innerHTML = '';

        // If no suggestions or empty query, hide dropdown
        if (!suggestions || suggestions.length === 0) {
            suggestionsContainer.classList.remove('show');
            return;
        }

        // Add suggestions to container
        suggestions.forEach(suggestion => {
            const item = document.createElement('div');
            item.className = 'suggestion-item';
            item.textContent = suggestion;

            // Add click event
            item.addEventListener('click', function() {
                // Set input value
                document.getElementById(`vehicle${type.charAt(0).toUpperCase() + type.slice(1)}`).value = suggestion;

                // Hide suggestions
                suggestionsContainer.classList.remove('show');

                // If make is selected, clear model and trims
                if (type === 'make') {
                    document.getElementById('vehicleModel').value = '';

                    // Clear trim dropdown
                    const trimSelect = document.getElementById('vehicleTrim');
                    while (trimSelect.options.length > 1) {
                        trimSelect.remove(1);
                    }
                }

                // If model is selected, fetch trims if make and year are also selected
                if (type === 'model') {
                    const make = document.getElementById('vehicleMake').value.trim();
                    const year = document.getElementById('vehicleYear').value;

                    if (make && year) {
                        fetchTrims(make, suggestion, year);
                    }
                }
            });

            suggestionsContainer.appendChild(item);
        });

        // Show dropdown
        suggestionsContainer.classList.add('show');
    }

    /**
     * Validate vehicle search form
     * @returns {boolean} Whether form is valid
     */
    function validateVehicleForm() {
        // Get form values
        const make = document.getElementById('vehicleMake').value.trim();
        const model = document.getElementById('vehicleModel').value.trim();
        const year = document.getElementById('vehicleYear').value;

        // Clear previous errors
        clearErrors();

        // Validate required fields
        let isValid = true;

        if (!make) {
            showError('vehicleMake', 'Please enter the vehicle make');
            isValid = false;
        }

        if (!model) {
            showError('vehicleModel', 'Please enter the vehicle model');
            isValid = false;
        }

        if (!year) {
            showError('vehicleYear', 'Please select the vehicle year');
            isValid = false;
        }

        return isValid;
    }

    /**
     * Validate Tool size search form
     * @returns {boolean} Whether form is valid
     */
    function validateToolSizeForm() {
        // Get form values
        const width = document.getElementById('ToolWidth').value.trim();
        const ratio = document.getElementById('aspectRatio').value.trim();
        const diameter = document.getElementById('wheelDiameter').value.trim();

        // Clear previous errors
        clearErrors();

        // Validate required fields
        let isValid = true;

        if (!width) {
            showError('ToolWidth', 'Please enter the Tool width');
            isValid = false;
        } else if (isNaN(width) || width < 0 || width > 500) {
            showError('ToolWidth', 'Please enter a valid Tool width (0-500)');
            isValid = false;
        }

        if (!ratio) {
            showError('aspectRatio', 'Please enter the aspect ratio');
            isValid = false;
        } else if (isNaN(ratio) || ratio < 0 || ratio > 100) {
            showError('aspectRatio', 'Please enter a valid aspect ratio (0-100)');
            isValid = false;
        }

        if (!diameter) {
            showError('wheelDiameter', 'Please enter the wheel diameter');
            isValid = false;
        } else if (isNaN(diameter) || diameter < 0 || diameter > 30) {
            showError('wheelDiameter', 'Please enter a valid wheel diameter (0-30)');
            isValid = false;
        }

        return isValid;
    }

    /**
     * Search for Tools based on vehicle or size
     * @param {string} searchType Type of search ('vehicle' or 'size')
     */
    function searchTools(searchType) {
        // Show loading state
        document.getElementById('resultsContainer').innerHTML = '<div class="spinner-container"><div class="spinner"></div></div>';

        // Show results section
        document.getElementById('resultsSection').classList.add('show');

        // Scroll to results
        document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });

        // Prepare search parameters
        const params = {};

        if (searchType === 'vehicle') {
            params.make = searchParams.make;
            params.model = searchParams.model;
            params.year = searchParams.year;

            if (searchParams.trim) {
                params.trim = searchParams.trim;
            }

            // Call API to get vehicle Tools
            ApiClient.getProductsByVehicle(params)
                .then(results => {
                    // Store search results
                    searchResults = results;

                    // Update results count
                    document.getElementById('resultsCount').textContent = `${results.length} products found`;

                    // Render results
                    renderSearchResults(results);

                    // Populate brand filter
                    populateBrandFilter(results);
                })
                .catch(error => {
                    console.error('Error searching Tools:', error);

                    // Show error message
                    document.getElementById('resultsContainer').innerHTML = `
                        <div class="no-results">
                            <div class="no-results-icon">‚ùå</div>
                            <h3 class="no-results-title">Error</h3>
                            <p class="no-results-message">Failed to search for Tools. Please try again later.</p>
                        </div>
                    `;
                });
        } else if (searchType === 'size') {
            params.size = searchParams.ToolSize;

            // Call API to get Tools by size
            ApiClient.getProducts({ size: params.size })
                .then(response => {
                    // Store search results
                    searchResults = response.content || [];

                    // Update results count
                    document.getElementById('resultsCount').textContent = `${searchResults.length} products found`;

                    // Render results
                    renderSearchResults(searchResults);

                    // Populate brand filter
                    populateBrandFilter(searchResults);
                })
                .catch(error => {
                    console.error('Error searching Tools:', error);

                    // Show error message
                    document.getElementById('resultsContainer').innerHTML = `
                        <div class="no-results">
                            <div class="no-results-icon">‚ùå</div>
                            <h3 class="no-results-title">Error</h3>
                            <p class="no-results-message">Failed to search for Tools. Please try again later.</p>
                        </div>
                    `;
                });
        }
    }

    /**
     * Render search results
     * @param {Array} results Array of product results
     */
    function renderSearchResults(results) {
        const resultsContainer = document.getElementById('resultsContainer');

        // Clear container
        resultsContainer.innerHTML = '';

        // If no results, show message
        if (!results || results.length === 0) {
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <div class="no-results-icon">üîç</div>
                    <h3 class="no-results-title">No Matching Tools Found</h3>
                    <p class="no-results-message">We couldn't find any Tools matching your search criteria. Try adjusting your search or contact us for assistance.</p>
                    <button class="btn" id="clearSearchBtn">Clear Search</button>
                </div>
            `;

            // Add event listener for clear search button
            document.getElementById('clearSearchBtn').addEventListener('click', function() {
                // Hide results section
                document.getElementById('resultsSection').classList.remove('show');

                // Reset forms
                document.getElementById('vehicleSearchForm').reset();
                document.getElementById('ToolSizeForm').reset();

                // Update size preview
                document.getElementById('sizePreview').textContent = '205/55R16';

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            return;
        }

        // Create results grid
        const resultsGrid = document.createElement('div');
        resultsGrid.className = 'results-grid';

        // Add each product to grid
        results.forEach(product => {
            resultsGrid.appendChild(createProductCard(product));
        });

        // Add grid to container
        resultsContainer.appendChild(resultsGrid);
    }

    /**
     * Create product card element
     * @param {Object} product Product data
     * @returns {HTMLElement} Product card element
     */
    function createProductCard(product) {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';

        // Generate stars based on rating
        const rating = product.rating || 0;
        const wholeStars = Math.floor(rating);
        const hasHalfStar = rating % 1 >= 0.5;
        const emptyStars = 5 - wholeStars - (hasHalfStar ? 1 : 0);

        let starsHtml = '';
        for (let i = 0; i < wholeStars; i++) {
            starsHtml += '<span class="star">‚òÖ</span>';
        }
        if (hasHalfStar) {
            starsHtml += '<span class="star">‚òÖ</span>';
        }
        for (let i = 0; i < emptyStars; i++) {
            starsHtml += '<span class="star">‚òÜ</span>';
        }

        // Format product type for display
        const productType = product.type
            ? product.type.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase())
            : '';

        productCard.innerHTML = `
            <div class="product-image">
                <img src="${product.imageUrl || 'https://via.placeholder.com/300x300?text=Tool'}" alt="${product.name}">
            </div>
            <div class="product-info">
                <h3 class="product-title">${product.name}</h3>
                <div class="product-meta">
                    <span>${product.size || ''}</span>
                    <span>${productType}</span>
                </div>
                <div class="product-rating">
                    ${starsHtml}
                    <span>(${product.reviewCount || 0})</span>
                </div>
                <div class="product-price">$${(product.price || 0).toFixed(2)}</div>
                <a href="product-detail.html?id=${product.id}" class="btn">View Details</a>
            </div>
        `;

        return productCard;
    }

    /**
     * Populate brand filter dropdown with unique brands from results
     * @param {Array} results Array of product results
     */
    function populateBrandFilter(results) {
        const brandFilter = document.getElementById('brandFilter');

        // Clear existing options except placeholder
        while (brandFilter.options.length > 1) {
            brandFilter.remove(1);
        }

        // Get unique brands from results
        const brands = [...new Set(results.map(product => product.brandName).filter(Boolean))];

        // Sort brands alphabetically
        brands.sort();

        // Add brand options
        brands.forEach(brand => {
            const option = document.createElement('option');
            option.value = brand;
            option.textContent = brand;
            brandFilter.appendChild(option);
        });
    }

    /**
     * Apply filters to search results
     */
    function applyFilters() {
        // If no search results, return
        if (!searchResults || searchResults.length === 0) {
            return;
        }

        // Filter results
        let filteredResults = [...searchResults];

        // Apply brand filter
        if (filterParams.brand) {
            filteredResults = filteredResults.filter(product =>
                product.brandName === filterParams.brand
            );
        }

        // Apply type filter
        if (filterParams.type) {
            filteredResults = filteredResults.filter(product =>
                product.type === filterParams.type
            );
        }

        // Apply price filter
        if (filterParams.priceRange) {
            const [min, max] = filterParams.priceRange.split('-').map(Number);

            filteredResults = filteredResults.filter(product => {
                const price = product.price || 0;

                if (max) {
                    return price >= min && price <= max;
                } else {
                    return price >= min;
                }
            });
        }

        // Apply sorting
        switch (filterParams.sort) {
            case 'price-low':
                filteredResults.sort((a, b) => (a.price || 0) - (b.price || 0));
                break;
            case 'price-high':
                filteredResults.sort((a, b) => (b.price || 0) - (a.price || 0));
                break;
            case 'rating':
                filteredResults.sort((a, b) => (b.rating || 0) - (a.rating || 0));
                break;
            case 'popularity':
                filteredResults.sort((a, b) => (b.reviewCount || 0) - (a.reviewCount || 0));
                break;
            default:
                // Default sorting (recommended) - no change
                break;
        }

        // Update results count
        document.getElementById('resultsCount').textContent = `${filteredResults.length} products found`;

        // Render filtered results
        renderSearchResults(filteredResults);
    }

    /**
     * Show error message for a specific field
     * @param {string} fieldId Field ID
     * @param {string} message Error message
     */
    function showError(fieldId, message) {
        const errorElement = document.getElementById(`${fieldId}Error`);
        const field = document.getElementById(fieldId);

        if (errorElement && field) {
            errorElement.textContent = message;
            errorElement.classList.add('visible');
            field.classList.add('error');
        }
    }

    /**
     * Clear all error messages
     */
    function clearErrors() {
        const errorElements = document.querySelectorAll('.error-message');
        const errorFields = document.querySelectorAll('.form-control.error');

        errorElements.forEach(element => {
            element.textContent = '';
            element.classList.remove('visible');
        });

        errorFields.forEach(field => {
            field.classList.remove('error');
        });
    }
</script>
</body>
</html>